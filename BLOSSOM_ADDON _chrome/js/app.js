let db;var trad=chrome.i18n.getMessage,script=document.createElement("script");function Ecrire(e,t){document.getElementById(e).innerHTML=t}function getRandomInt(e){return Math.floor(Math.random()*e)}function test(){alert("test")}function ProFun(){modenormal=localStorage.getItem("profunStorage"),"false"==modenormal?(localStorage.setItem("profunStorage","true"),boutonprofun.value=trad("button_pro")):(localStorage.setItem("profunStorage","false"),boutonprofun.value=trad("button_normal"))}function openoption(){window.open("option.html","newFenetre")}function openweek(){window.open("weekly_report/graphique librairie.html","newFenetre")}function bytesToSize(e){var t=[trad("size_Bytes"),trad("size_KB"),trad("size_MB"),trad("size_GB"),trad("size_TB")];if(0==e)return"0 "+trad("size_Bytes");var o=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(100*e/Math.pow(1024,o),2)/100+t[o]}function getWeek(e=0){let t=new Date;dowOffset=new Date(t.getDay(),0,0),dowOffset="number"==typeof dowOffset?dowOffset:0;var o=new Date(t.getFullYear(),0,1),n=o.getDay()-dowOffset;n=n>=0?n:n+7;var r,a=Math.floor((t.getTime()-o.getTime()-6e4*(t.getTimezoneOffset()-o.getTimezoneOffset()))/864e5)+1;n<4?(r=Math.floor((a+n-1)/7)+1)>52&&(nYear=new Date(t.getFullYear()+1,0,1),nday=nYear.getDay()-dowOffset,nday=nday>=0?nday:nday+7,r=nday<4?1:53):r=Math.floor((a+n-1)/7);let u=r+e,i=(new Date).getFullYear();return u<=0&&(u=52+u,i-=1),"W"+u+"Y"+i}script.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(script);var pourcentage=localStorage.getItem("Score");if(pourcentage<10)var Pourcentage_entier=0;else if(100==pourcentage)Pourcentage_entier=9;else{var Pourcentage_texte=(Pourcentage_texte=pourcentage.toString()).slice(0,1);Pourcentage_entier=parseInt(Pourcentage_texte)}let var1="<img src='image/arbre_",var2=".png 'alt='Photo dun arbre en mauvaise santÃ©'/>",var3=var1+Pourcentage_entier+var2,imageinp=document.getElementById("image");imageinp.innerHTML=var3;let phrase=trad("ecoscore",pourcentage);if(Ecrire("ecolo",phrase),modenormal=localStorage.getItem("profunStorage"),"false"==modenormal)var textbtn=trad("button_normal");else textbtn=trad("button_pro");var boutonprofun=document.createElement("input");boutonprofun.type="button",boutonprofun.value=textbtn,boutonprofun.id="profun",boutonprofun.classList.add("styled");var append=document.getElementById("profun");append.appendChild(boutonprofun),boutonprofun.addEventListener("click",()=>{ProFun()}),totoc=localStorage.getItem("consomationtotal"),totol=bytesToSize(totoc),Ecrire("toto",trad("total_consumption",totol));let parametre=document.getElementById("para");parametre.addEventListener("click",()=>{openoption()});let weeklyreport=document.getElementById("week");weeklyreport.addEventListener("click",()=>{openweek()});var boutonpara=document.getElementById("para");boutonpara.value=trad("button_settings");var wr=document.getElementById("week");wr.value=trad("weekly_report");let request=window.indexedDB.open("suivi_conso",1);function showData(e){var t=db.transaction(["suivi_conso"],"readwrite").objectStore("suivi_conso").index("semaine").get(e);t.onsuccess=function(){try{o=bytesToSize(o=t.result.consomation);var e=t.result.site;e=Object.keys(e).length}catch(t){var o=0;e=0}Ecrire("cettesemaine",trad("week_consumption",[o,e]))}}request.onerror=function(){console.log("Database failed to open")},request.onsuccess=function(){console.log("Database opened successfully"),db=request.result,showData(getWeek())},document.getElementById("name").innerHTML=trad("extensionName");