let db;var trad=chrome.i18n.getMessage;function getWeek(e=0){let t=new Date;dowOffset=new Date(t.getDay(),0,0),dowOffset="number"==typeof dowOffset?dowOffset:0;var n=new Date(t.getFullYear(),0,1),o=n.getDay()-dowOffset;o=o>=0?o:o+7;var l,s=Math.floor((t.getTime()-n.getTime()-6e4*(t.getTimezoneOffset()-n.getTimezoneOffset()))/864e5)+1;o<4?(l=Math.floor((s+o-1)/7)+1)>52&&(nYear=new Date(t.getFullYear()+1,0,1),nday=nYear.getDay()-dowOffset,nday=nday>=0?nday:nday+7,l=nday<4?1:53):l=Math.floor((s+o-1)/7);let r=l+e,a=(new Date).getFullYear();return r<=0&&(r=52+r,a-=1),"W"+r+"Y"+a}async function GetConso(e){return new Promise((t,n)=>{var o=db.transaction(["suivi_conso"],"readwrite").objectStore("suivi_conso").index("semaine").get(e);o.onsuccess=async function(){let e;try{e=o.result.consomation}catch(t){e=0}t(e*=9.5367431640625e-7)}})}async function GetSite(){return new Promise((e,t)=>{var n=db.transaction(["suivi_conso"],"readwrite").objectStore("suivi_conso").index("semaine").get(getWeek());n.onsuccess=async function(){let t;try{t=n.result.site}catch(e){t=[]}e(t)}})}let request=window.indexedDB.open("suivi_conso",1);request.onerror=function(){console.log("Database 2 failed to open")},request.onsuccess=function(){db=request.result,console.log("Database 2 opened successfully"),thelisteconso=Promise.all([GetConso(getWeek(0)),GetConso(getWeek(-1)),GetConso(getWeek(-2)),GetConso(getWeek(-3)),GetConso(getWeek(-4)),GetConso(getWeek(-5))]).then(e=>{!function(e){var t=[];for(let e=0;e<7;e++)gettruc=getWeek(-e),Y=gettruc.indexOf("Y"),sem=gettruc.substring(Y+1)+" "+gettruc.substring(0,Y),t.push(sem);new Morris.Line({element:"barres",lineColors:["#35a82f"],data:[{barre:t[5],value:e[5].toFixed(1)},{barre:t[4],value:e[4].toFixed(1)},{barre:t[3],value:e[3].toFixed(1)},{barre:t[2],value:e[2].toFixed(1)},{barre:t[1],value:e[1].toFixed(1)},{barre:t[0],value:e[0].toFixed(1)}],xkey:"barre",ykeys:["value"],yLabelFormat:function(e){return e.toString()+" "+trad("size_MB")},hideHover:["auto"],labels:[trad("consumption")],goalStrokeWidth:"2px",resize:!0}),window.onload=function(){var t=e[0],n=7.2e-11*(t/=9.5367431640625e-7);n+=t*(1.52*1e-10),CO2=(59*n).toFixed(1);(CO2/76.5).toFixed(1);var o=CO2/.126,l=n/.009,s=Math.trunc(l),r=60*(l-s);document.getElementById("calcul1").innerHTML=trad("calcul1",[e[0].toFixed(1),CO2]),document.getElementById("calcul3").innerHTML=trad("calcul3",[s,r.toFixed(0)]),document.getElementById("calcul4").innerHTML=trad("calcul2",o.toFixed(1))}}(e)}),thelistesite=Promise.all([GetSite()]).then(e=>{sites=e[0],fetch("/../bdd_sites.json").then(e=>e.json()).then(e=>(function(e,t){var n={Streaming:0,Mails:0,Recherches:0,Telechargement:0,Reseaux_Sociaux:0,Autres:.01,Cloud:0,E_commerce:0};for(let o in e){let l=0;for(categorie in t)-1!=t[categorie].indexOf(o)?n[categorie]+=9.5367431640625e-7*e[o]:l++,6==l&&(n.Autres+=9.5367431640625e-7*e[o])}new Morris.Donut({element:"donut",colors:["#35a82f","#f06c0e"],data:[{label:trad("Streaming"),value:n.Streaming.toFixed(2)},{label:trad("Email"),value:n.Mails.toFixed(2)},{label:trad("Research"),value:n.Recherches.toFixed(2)},{label:trad("Social_Networks"),value:n.Reseaux_Sociaux.toFixed(2)},{label:trad("Others"),value:n.Autres.toFixed(2)},{label:trad("Cloud"),value:n.Cloud.toFixed(2)},{label:trad("Ecommerce"),value:n.E_commerce.toFixed(2)}],labelColor:"#FFFFFF",formatter:function(e,t){return e+" "+trad("size_MB")}})})(sites,e))})},document.getElementById("weekly_title3").innerHTML=trad("weekly_title3"),document.getElementById("weekly_title2").innerHTML=trad("weekly_title2"),document.getElementById("weekly_title1").innerHTML=trad("weekly_title1"),document.getElementById("conseil").innerHTML=trad("conseil"),document.getElementById("lesconseils_t01").innerHTML=trad("lesconseils_t01"),document.getElementById("lesconseils_t02").innerHTML=trad("lesconseils_t02"),document.getElementById("lesconseils_t03").innerHTML=trad("lesconseils_t03"),document.getElementById("lesconseils_t04").innerHTML=trad("lesconseils_t04"),document.getElementById("lesconseils_t05").innerHTML=trad("lesconseils_t05"),document.getElementById("lesconseils_t06").innerHTML=trad("lesconseils_t06"),document.getElementById("lesconseils_t07").innerHTML=trad("lesconseils_t07"),document.getElementById("lesconseils_t08").innerHTML=trad("lesconseils_t08"),document.getElementById("Toulouse_CDG_t01").innerHTML=trad("Toulouse_CDG_t01"),document.getElementById("Toulouse_CDG_t02").innerHTML=trad("Toulouse_CDG_t02");